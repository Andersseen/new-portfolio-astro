---
import "@styles/global.css";
import LanguageSelector from "@componentes/LanguageSelector.astro";
import Header from "@componentes/Header";
---

<!doctype html>
<html lang="en" data-theme="light">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Andersseen Dev - Portfolio</title>
		
		<!-- Load theme immediately to prevent flash -->
		<script is:inline>
			(async function() {
				// Try to load from IDB first
				try {
					const dbRequest = indexedDB.open('portfolio-db', 1);
					dbRequest.onsuccess = function() {
						const db = dbRequest.result;
						if (db.objectStoreNames.contains('kv')) {
							const tx = db.transaction('kv', 'readonly');
							const store = tx.objectStore('kv');
							const request = store.get('theme-state');
							request.onsuccess = function() {
								const state = request.result;
								if (state && state.userSet) {
									document.documentElement.setAttribute('data-theme', state.mode);
									if (state.colors) {
										const root = document.documentElement;
										root.style.setProperty('--color-primary', state.colors.primary);
										root.style.setProperty('--color-secondary', state.colors.secondary);
										root.style.setProperty('--color-accent', state.colors.accent);
										root.style.setProperty('--color-success', state.colors.success);
										root.style.setProperty('--color-warning', state.colors.warning);
									}
								} else {
									// Fallback to system preference
									const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
									document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
								}
							};
						}
					};
				} catch (e) {
					// Fallback to system preference
					const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
					document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
				}
			})();
		</script>
	</head>
	<body>
		<!-- Header with Theme Controls and Language Selector -->
		<header class="fixed top-0 right-0 z-50 p-4 flex items-center gap-3">
			<LanguageSelector />
			<Header client:load />
		</header>

		<slot />
	</body>
</html>

<script>
	import '@scripts/theme-toggle.ts';
	import '@scripts/theme-randomizer.ts';
	import '@scripts/card-modal.ts';
</script>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
